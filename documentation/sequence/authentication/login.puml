@startuml

' Font configuration
skinparam defaultFontName Times New Roman
skinparam defaultFontSize 15

' Participant styling
skinparam participant {
    BackgroundColor #ECF0F1
    BorderColor #34495E
    FontColor Black
    FontName Times New Roman
    FontSize 15
}

skinparam sequence {
    ArrowColor #34495E
    LifeLineBorderColor #34495E
    LifeLineBackgroundColor #ECF0F1
    ArrowFontName Times New Roman
    ArrowFontSize 18
}

skinparam actorFontSize 15
skinparam noteFontSize 15
skinparam noteFontName "Times New Roman"

' Actors and components
actor "Administrator" as admin #E74C3C
actor "Manager" as mgr #3498DB
actor "Supervisor" as spv #2ECC71
actor "Maintenance" as mtn #F39C12
actor "Operator" as op #9B59B6
boundary "Login Page" as boundLogin #3498DB
control "User\nController" as userController #2ECC71
control "User\nService" as userService #F39C12
control "User\nRepository" as userRepository #E67E22
database "PostgreSQL" as dbPsql #2980B9
database "Redis Cache" as dbRedis #C0392B

title
<size:20><b>Sequence Diagram - Login</b></size>
----
end title

autonumber

' === MAIN FLOW ===
admin -> boundLogin: Enter Credentials
activate boundLogin

boundLogin -> userController: POST /login
activate userController

userController -> userController: Parsing Request

userController -> userService: Forward Request
activate userService

' === FIND USER ===
userService -> userService: Validate Request
userService -> userRepository: Find by Username/Email
activate userRepository

userRepository -> dbPsql: Find User by\nUsername/Email
activate dbPsql
dbPsql --> userRepository: User Data
deactivate dbPsql

userRepository --> userService: User Data
deactivate userRepository

' === ERROR SCENARIOS ===
alt #LightPink User Not Found
    userService --> userController: 404 User Not Found
    userController --> boundLogin: Error Response
    boundLogin --> admin: **Show Error Message**

else #LightGreen User Found
        userService -> userService: Verify Password

    alt #LightPink Invalid Credentials
        userService --> userController: 401 Unauthorized
        userController --> boundLogin: Error Response
        boundLogin --> admin: **Show Error Message**
    else #LightGreen Success
        ' === AUTHENTICATION SUCCESS ===
        userService -> userService: Generate JWT Token

        userService -> dbRedis: Store Token
        activate dbRedis
        dbRedis --> userService: OK
        deactivate dbRedis

        userService -> userService: Record Audit Log

        userService --> userController: Token & User Data
        deactivate userService

        userController --> boundLogin: 200 OK + Token
        deactivate userController

        boundLogin -> boundLogin: Store Token in Cookie
        boundLogin --> admin: **Redirect to Dashboard**
        deactivate boundLogin
      end

end

@enduml