@startuml

' Font configuration
skinparam defaultFontName Times New Roman
skinparam defaultFontSize 15

' Participant styling
skinparam participant {
    BackgroundColor #ECF0F1
    BorderColor #34495E
    FontColor Black
    FontName Times New Roman
    FontSize 15
}

skinparam sequence {
    ArrowColor #34495E
    LifeLineBorderColor #34495E
    LifeLineBackgroundColor #ECF0F1
    ArrowFontName Times New Roman
    ArrowFontSize 15
}

skinparam actorFontSize 15
skinparam noteFontSize 15
skinparam noteFontName "Times New Roman"

' Actors and components
actor "Administrator" as admin #E74C3C
actor "Manager" as mgr #3498DB
actor "Supervisor" as spv #2ECC71
actor "Maintenance" as mtn #F39C12
actor "Operator" as op #9B59B6
boundary "Generate Report " as boundList #3498DB
control "Auth\nMiddleware" as authMiddleware #9B59B6
control "Layer\nController" as controller #2ECC71
control "Layer\nService" as service #F39C12
control "Layer\nRepository" as repository #E67E22
database "Redis Cache" as dbRedis #C0392B
database "PostgreSQL" as dbPsql #2980B9

title
<size:20><b>Sequence Diagram - Generate Report</b></size>
----
end title

autonumber



' === MAIN FLOW ===
admin -> boundList: Access Generate Report List Page
activate boundList
admin -> boundList: Fill Filtering Data
note over admin, op
- Start Date
- End Date
- Interval
- Record Document Template
end note
boundList -> authMiddleware: GET /telemetries/report
activate authMiddleware

' === AUTHENTICATION ===
authMiddleware -> dbRedis: Validate JWT Token
activate dbRedis
dbRedis --> authMiddleware: Token Status
deactivate dbRedis

alt #LightPink Unauthorized (401)
    authMiddleware --> boundList: Authentication Failed
    boundList --> admin: **Redirect to Login**
    deactivate authMiddleware
    deactivate boundList
    
else #LightPink Forbidden (403)
    authMiddleware --> boundList: Insufficient Permission
    boundList --> admin: **Show 403 Forbidden Page**
    deactivate authMiddleware
    deactivate boundList
    
else #LightGreen Authenticated

    authMiddleware -> controller: Forward Request
    deactivate authMiddleware
    activate controller

    controller -> service: Generate Report
    activate service

    ' === FETCH DATA FROM DATABASE ===
    service -> repository: Find All with Filters
    activate repository
    
    repository -> dbPsql: Query <resource> Data\n With Filter
    activate dbPsql
    dbPsql --> repository: Data Result
    deactivate dbPsql

    repository --> service: Return <resource> List
    deactivate repository

service -> service: Grouped By Timestamp
    service --> controller: Return Data List
    deactivate service

    controller --> boundList: 200 OK + Data
    deactivate controller

    boundList --> admin: **Display <resource> List**
    deactivate boundList

end

@enduml