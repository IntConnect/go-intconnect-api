@startuml

' Font configuration
skinparam defaultFontName Times New Roman
skinparam defaultFontSize 15

' Participant styling
skinparam participant {
    BackgroundColor #ECF0F1
    BorderColor #34495E
    FontColor Black
    FontName Times New Roman
    FontSize 15
}

skinparam sequence {
    ArrowColor #34495E
    LifeLineBorderColor #34495E
    LifeLineBackgroundColor #ECF0F1
    ArrowFontName Times New Roman
    ArrowFontSize 15
}

skinparam actorFontSize 15
skinparam noteFontSize 15
skinparam noteFontName "Times New Roman"

' Actors and components
actor "Administrator" as admin #E74C3C
boundary "List Page" as boundList #3498DB
control "Auth\nMiddleware" as authMiddleware #9B59B6
control "Layer\nController" as controller #2ECC71
control "Layer\nService" as service #F39C12
control "Layer\nRepository" as repository #E67E22
control "File\nService" as fileService #16A085
database "Redis Cache" as dbRedis #C0392B
database "PostgreSQL" as dbPsql #2980B9

title
<size:20><b>Sequence Diagram - Update Machine Dashboard Data</b></size>
----
end title

autonumber


' === FETCH EXISTING DATA ===
admin -> boundList: Access Machine List Page
admin -> boundList: Press Dashboard Button
note over admin, boundList
Button with Gauge Icon
end note
admin -> boundList: Add Featured Parameter
admin -> boundList: Change Chart

activate boundList

boundList -> authMiddleware: PUT\n/machines/dashboard/{id}

' === AUTHENTICATION ===
authMiddleware -> dbRedis: Validate JWT Token
activate dbRedis
dbRedis --> authMiddleware: Token Status
deactivate dbRedis

alt #LightPink Unauthorized (401)
    authMiddleware --> boundList: Authentication Failed
    boundList --> admin: **Redirect to Login**
    deactivate authMiddleware
    deactivate boundList
else #LightPink Forbidden (403)
    authMiddleware --> boundList: Insufficient Permission
    boundList --> admin: **Redirect to Forbidden Page**
    deactivate authMiddleware
    deactivate boundList
else #LightGreen Authenticated
        ' === UPDATE PROCESS ===



        authMiddleware -> controller: Forward Request
        deactivate authMiddleware
        activate controller

        controller -> controller: Validate Request

        controller -> service: Process Update
        activate service

        service -> service: Business Validation\n(Duplication, Rules)

        alt #LightPink Validation Failed
            service --> controller: 422 Validation Error
            controller --> boundList: Error Response
            boundList --> admin: **Show Validation Error**
            deactivate service
            deactivate controller

        else #LightGreen Validation Success



            ' === UPDATE DATABASE ===
            service -> repository: Update Existing Data
            activate repository

            repository -> dbPsql: Update <resource> Data
            activate dbPsql


            alt #LightPink Database Error
                dbPsql --> repository: SQLException
                deactivate dbPsql

                repository --> service: Database Error
                service -> service: Parsing Error



                service --> controller: 500 Internal Server Error
                controller --> boundList: Error Response
                boundList --> admin: **Show Error Message**
                deactivate service
                deactivate controller

            else #LightGreen Success
                dbPsql --> repository: Success
                deactivate dbPsql

                repository --> service: Success
                deactivate repository

                service --> controller: Success Response
                deactivate service

                controller --> boundList: 200 OK
                deactivate controller

                boundList --> admin: **Show Success Message**
                boundList --> admin: **Redirect to /machines/dashboard/{id}**
                deactivate boundList
            end
        end
end
@enduml